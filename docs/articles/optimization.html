<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Optimization • nlrx | NetLogo from R</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Optimization">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nlrx | NetLogo from R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/getstarted.html">
    <span class="fa fa fa fa-magic"></span>
     
    Get Started
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-graduation-cap"></span>
     
    More
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/simdesign-examples.html">
        <span class="fa fa-book"></span>
         
        Simdesign examples
      </a>
    </li>
    <li>
      <a href="../articles/furthernotes.html">
        <span class="fa fa-sticky-note"></span>
         
        Advanced configuration
      </a>
    </li>
    <li>
      <a href="../articles/sensitivity.html">
        <span class="fa fa-sticky-note"></span>
         
        Sensitivity Analysis with nlrx
      </a>
    </li>
    <li>
      <a href="../articles/optimization.html">
        <span class="fa fa-sticky-note"></span>
         
        Optimization with nlrx
      </a>
    </li>
    <li>
      <a href="../articles/articles/spatial-output.html">
        <span class="fa fa-calculator"></span>
         
        Capturing spatial NetLogo output
      </a>
    </li>
    <li>
      <a href="../articles/articles/interfacing-different-models.html">
        <span class="fa fa-file-text-o"></span>
         
        Interfacing a variety of different NetLogo models
      </a>
    </li>
    <li>
      <a href="../articles/articles/nlrx_nldoc.html">
        <span class="fa fa-file-text-o"></span>
         
        NetLogo documentation with nlrx
      </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    news
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-gears"></span>
     
    functions
  </a>
</li>
<li>
  <a href="https://github.com/nldoc/nlrx">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Optimization</h1>
                        <h4 class="author">Jan Salecker</h4>
            
            <h4 class="date">2019-09-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nldoc/nlrx/blob/master/vignettes/optimization.Rmd"><code>vignettes/optimization.Rmd</code></a></small>
      <div class="hidden name"><code>optimization.Rmd</code></div>

    </div>

    
    
<div id="optimization-with-nlrx" class="section level2">
<h2 class="hasAnchor">
<a href="#optimization-with-nlrx" class="anchor"></a>Optimization with nlrx</h2>
<p>Here we present two simple examples for running an optimization algorithm on a NetLogo model with nlrx. In our example, we use the Simulated Annealing simdesign (<code><a href="../reference/simdesign_GenSA.html">simdesign_GenSA()</a></code>). However, except for the parameter definitions in the simdesign function and hte output of the function, the genetic algorithm optimization (<code><a href="../reference/simdesign_GenAlg.html">simdesign_GenAlg()</a></code>) works in the same way.</p>
<p>We use the Wolf Sheep Predation model from the models library to show a basic example of the optimization workflow. Example 1 shows, how a NetLogo reporter can be used as a fitness criterion for optimization. Example 2 uses a self-defined evaluation function that calculates landscape metrics that are then used as fitness criterion.</p>
</div>
<div id="example-1-netlogo-reporter-as-fitness-criterion" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1-netlogo-reporter-as-fitness-criterion" class="anchor"></a>Example 1: NetLogo reporter as fitness criterion</h2>
<div id="step-1-create-a-nl-object" class="section level4">
<h4 class="hasAnchor">
<a href="#step-1-create-a-nl-object" class="anchor"></a>Step 1: Create a nl object:</h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(nlrx)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co"># Windows default NetLogo installation path (adjust to your needs!):</span></a>
<a class="sourceLine" id="cb1-3" title="3">netlogopath &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"C:/Program Files/NetLogo 6.0.3"</span>)</a>
<a class="sourceLine" id="cb1-4" title="4">modelpath &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(netlogopath, <span class="st">"app/models/Sample Models/Biology/Wolf Sheep Predation.nlogo"</span>)</a>
<a class="sourceLine" id="cb1-5" title="5">outpath &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"C:/out"</span>)</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co"># Unix default NetLogo installation path (adjust to your needs!):</span></a>
<a class="sourceLine" id="cb1-7" title="7">netlogopath &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"/home/NetLogo 6.0.3"</span>)</a>
<a class="sourceLine" id="cb1-8" title="8">modelpath &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(netlogopath, <span class="st">"app/models/Sample Models/Biology/Wolf Sheep Predation.nlogo"</span>)</a>
<a class="sourceLine" id="cb1-9" title="9">outpath &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"/home/out"</span>)</a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11">nl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nl.html">nl</a></span>(<span class="dt">nlversion =</span> <span class="st">"6.0.3"</span>,</a>
<a class="sourceLine" id="cb1-12" title="12">         <span class="dt">nlpath =</span> netlogopath,</a>
<a class="sourceLine" id="cb1-13" title="13">         <span class="dt">modelpath =</span> modelpath,</a>
<a class="sourceLine" id="cb1-14" title="14">         <span class="dt">jvmmem =</span> <span class="dv">1024</span>)</a></code></pre></div>
</div>
<div id="step-2-attach-an-experiment" class="section level4">
<h4 class="hasAnchor">
<a href="#step-2-attach-an-experiment" class="anchor"></a>Step 2: Attach an experiment</h4>
<p>Because we want to apply an optimization algorithm, we need to define proper variable ranges. The algorithm is allowed to change the values of these parameters within these ranges in order to minimize our fitness criterion. In this example we want to use a reporter from the metrics slot for evaluating our model runs. Here we want to find a parameterization that leads to the maximum number of wolfs after 50 ticks. Because the algorithm automatically searches for minimum values, we add <code>"1 / count wolves"</code> to the metrics vector in order to find the maximum number of wolves.</p>
<p>It is also important to think about the settings for tickmetrics, runtime and evalticks. Because we only want to consider the last tick of the simulation, we set tickmetrics to “false” and runtime to 50. If more than one tick would be measured, the algorithm automatically calculates the mean value of the selected reporter. If you wish to apply other functions to aggregate temporal information into one value, you can use a self-defined evaluation function (see Example 2).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">nl<span class="op">@</span>experiment &lt;-<span class="st"> </span><span class="kw"><a href="../reference/experiment.html">experiment</a></span>(<span class="dt">expname=</span><span class="st">"wolf-sheep-GenSA1"</span>,</a>
<a class="sourceLine" id="cb2-2" title="2">                            <span class="dt">outpath=</span>outpath,</a>
<a class="sourceLine" id="cb2-3" title="3">                            <span class="dt">repetition=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb2-4" title="4">                            <span class="dt">tickmetrics=</span><span class="st">"false"</span>,</a>
<a class="sourceLine" id="cb2-5" title="5">                            <span class="dt">idsetup=</span><span class="st">"setup"</span>,</a>
<a class="sourceLine" id="cb2-6" title="6">                            <span class="dt">idgo=</span><span class="st">"go"</span>,</a>
<a class="sourceLine" id="cb2-7" title="7">                            <span class="dt">runtime=</span><span class="dv">50</span>,</a>
<a class="sourceLine" id="cb2-8" title="8">                            <span class="dt">metrics=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"(1 / count wolves)"</span>),</a>
<a class="sourceLine" id="cb2-9" title="9">                            <span class="dt">variables =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">'initial-number-sheep'</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">min=</span><span class="dv">50</span>, <span class="dt">max=</span><span class="dv">150</span>, <span class="dt">qfun=</span><span class="st">"qunif"</span>),</a>
<a class="sourceLine" id="cb2-10" title="10">                                             <span class="st">'initial-number-wolves'</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">min=</span><span class="dv">50</span>, <span class="dt">max=</span><span class="dv">150</span>, <span class="dt">qfun=</span><span class="st">"qunif"</span>)),</a>
<a class="sourceLine" id="cb2-11" title="11">                            <span class="dt">constants =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"model-version"</span> =<span class="st"> "</span><span class="ch">\"</span><span class="st">sheep-wolves-grass</span><span class="ch">\"</span><span class="st">"</span>,</a>
<a class="sourceLine" id="cb2-12" title="12">                                             <span class="st">"grass-regrowth-time"</span> =<span class="st"> </span><span class="dv">30</span>,</a>
<a class="sourceLine" id="cb2-13" title="13">                                             <span class="st">"sheep-gain-from-food"</span> =<span class="st"> </span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb2-14" title="14">                                             <span class="st">"wolf-gain-from-food"</span> =<span class="st"> </span><span class="dv">20</span>,</a>
<a class="sourceLine" id="cb2-15" title="15">                                             <span class="st">"sheep-reproduce"</span> =<span class="st"> </span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb2-16" title="16">                                             <span class="st">"wolf-reproduce"</span> =<span class="st"> </span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb2-17" title="17">                                             <span class="st">"show-energy?"</span> =<span class="st"> "false"</span>))</a></code></pre></div>
</div>
<div id="step-3-attach-a-simulation-design" class="section level4">
<h4 class="hasAnchor">
<a href="#step-3-attach-a-simulation-design" class="anchor"></a>Step 3: Attach a simulation design</h4>
<p>We use the <code>simdesgin_GenSA()</code> function to attach a Simulated Annealing simdesign. We select the evaluation criterion (<code>evalcrit</code>) by assigning the position of the reporter that we want to evaluate within the metrics vector of the experiment. In our case, there is only one reporter in the metrics vector thus we set evalcrit to use the first reporter (<code>evalcrit = 1</code>). The control parameter allows us to provide additional parameters for the GenSA function (see ?GenSA for details). For demonstration purposes, we set the maximum number of iterations to 20.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">nl<span class="op">@</span>simdesign &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simdesign_GenSA.html">simdesign_GenSA</a></span>(nl, </a>
<a class="sourceLine" id="cb3-2" title="2">                                <span class="dt">evalcrit =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb3-3" title="3">                                <span class="dt">nseeds =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb3-4" title="4">                                <span class="dt">control=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">maxit =</span> <span class="dv">20</span>))</a></code></pre></div>
</div>
<div id="step-4-run-simulations" class="section level4">
<h4 class="hasAnchor">
<a href="#step-4-run-simulations" class="anchor"></a>Step 4: Run simulations</h4>
<p>For optimization simdesign, the <code><a href="../reference/run_nl_dyn.html">run_nl_dyn()</a></code> function lets you execute the simulations. There are some notable differences between <code><a href="../reference/run_nl_all.html">run_nl_all()</a></code> and <code><a href="../reference/run_nl_dyn.html">run_nl_dyn()</a></code>. First, because parameterizations depend of results from previous runs, <code><a href="../reference/run_nl_dyn.html">run_nl_dyn()</a></code> can not be parallelized. Second, the procedure does not automatically loop over created random seeds of the simdesign. If you want to repeat the same algorithm several times, just embed the <code><a href="../reference/run_nl_dyn.html">run_nl_dyn()</a></code> function in any kind of loop and iterate through the <code>nl@simdesign@simseeds</code> vector. Third, the output of <code><a href="../reference/run_nl_dyn.html">run_nl_dyn()</a></code> is reported as objects from the specific optimization procedures and not in tibble format. In order to attach these results to the nl object, the output needs to be converted to tibble format first. However, attaching optimization results to the nl does not enable any further post-processing functions of the nlrx package and is only relevant for storing results together with the nl object. This design decision was made in order to allow application of the method specific summary functions to the results of the optimization.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/run_nl_dyn.html">run_nl_dyn</a></span>(nl, <span class="dt">seed =</span> nl<span class="op">@</span>simdesign<span class="op">@</span>simseeds[<span class="dv">1</span>])</a></code></pre></div>
</div>
<div id="step-5-investigate-output" class="section level4">
<h4 class="hasAnchor">
<a href="#step-5-investigate-output" class="anchor"></a>Step 5: Investigate output</h4>
<p>The output list of the Simulated Annealing procedure contains four elements: <code>value</code> reports the minimum final value of the evaluation criterion. <code>par</code> reports the parameter settings of the final parameterisation in the same order as defined in the experiment of the nl object. <code>trace.mat</code> gives you detailed information on the optimization process over all iterations. <code>counts</code> indicates how often the optimization procedure was executed in total.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">results</a></code></pre></div>
<p>In order to store our results together with the nl object we need to attach the results to the nl object first. As explained above, we need to enframe the results as a tibble.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">nl<span class="op">@</span>simdesign<span class="op">@</span>simoutput &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/enframe.html">enframe</a></span>(results)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(nl, <span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(nl<span class="op">@</span>experiment<span class="op">@</span>outpath, <span class="st">"genSA_1.rds"</span>))</a></code></pre></div>
</div>
</div>
<div id="example-2-evaluation-function-as-fitness-criterion" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-evaluation-function-as-fitness-criterion" class="anchor"></a>Example 2: Evaluation function as fitness criterion</h2>
<div id="step-1-create-a-nl-object-1" class="section level4">
<h4 class="hasAnchor">
<a href="#step-1-create-a-nl-object-1" class="anchor"></a>Step 1: Create a nl object:</h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(nlrx)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co"># Windows default NetLogo installation path (adjust to your needs!):</span></a>
<a class="sourceLine" id="cb7-3" title="3">netlogopath &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"C:/Program Files/NetLogo 6.0.3"</span>)</a>
<a class="sourceLine" id="cb7-4" title="4">modelpath &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(netlogopath, <span class="st">"app/models/Sample Models/Biology/Wolf Sheep Predation.nlogo"</span>)</a>
<a class="sourceLine" id="cb7-5" title="5">outpath &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"C:/out"</span>)</a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co"># Unix default NetLogo installation path (adjust to your needs!):</span></a>
<a class="sourceLine" id="cb7-7" title="7">netlogopath &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"/home/NetLogo 6.0.3"</span>)</a>
<a class="sourceLine" id="cb7-8" title="8">modelpath &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(netlogopath, <span class="st">"app/models/Sample Models/Biology/Wolf Sheep Predation.nlogo"</span>)</a>
<a class="sourceLine" id="cb7-9" title="9">outpath &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"/home/out"</span>)</a>
<a class="sourceLine" id="cb7-10" title="10"></a>
<a class="sourceLine" id="cb7-11" title="11">nl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nl.html">nl</a></span>(<span class="dt">nlversion =</span> <span class="st">"6.0.3"</span>,</a>
<a class="sourceLine" id="cb7-12" title="12">         <span class="dt">nlpath =</span> netlogopath,</a>
<a class="sourceLine" id="cb7-13" title="13">         <span class="dt">modelpath =</span> modelpath,</a>
<a class="sourceLine" id="cb7-14" title="14">         <span class="dt">jvmmem =</span> <span class="dv">1024</span>)</a></code></pre></div>
</div>
<div id="step-2-attach-an-experiment-1" class="section level4">
<h4 class="hasAnchor">
<a href="#step-2-attach-an-experiment-1" class="anchor"></a>Step 2: Attach an experiment</h4>
<p>Because we want to apply an optimization algorithm, we need to define proper variable ranges. The algorithm is allowed to change the values of these parameters within these ranges in order to minimize our fitness criterion. In this example we want to use a self-defined evaluation function to calculate a fitness criterion. Thus, we add the patch coordinates and patch color (as a patch class indicator) to the <code>metrics.patches</code> vector. We want to use spatial data to calculate the landscape edge density index of the final tick and find a parameterization that leads to the edge density. Because we only want to consider the last tick of the simulation, we set tickmetrics to “false” and runtime to 50.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">nl<span class="op">@</span>experiment &lt;-<span class="st"> </span><span class="kw"><a href="../reference/experiment.html">experiment</a></span>(<span class="dt">expname=</span><span class="st">"wolf-sheep-GenSA2"</span>,</a>
<a class="sourceLine" id="cb8-2" title="2">                            <span class="dt">outpath=</span>outpath,</a>
<a class="sourceLine" id="cb8-3" title="3">                            <span class="dt">repetition=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb8-4" title="4">                            <span class="dt">tickmetrics=</span><span class="st">"false"</span>,</a>
<a class="sourceLine" id="cb8-5" title="5">                            <span class="dt">idsetup=</span><span class="st">"setup"</span>,</a>
<a class="sourceLine" id="cb8-6" title="6">                            <span class="dt">idgo=</span><span class="st">"go"</span>,</a>
<a class="sourceLine" id="cb8-7" title="7">                            <span class="dt">runtime=</span><span class="dv">50</span>,</a>
<a class="sourceLine" id="cb8-8" title="8">                            <span class="dt">metrics.patches =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pxcor"</span>, <span class="st">"pycor"</span>, <span class="st">"pcolor"</span>),</a>
<a class="sourceLine" id="cb8-9" title="9">                            <span class="dt">variables =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">'initial-number-sheep'</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">min=</span><span class="dv">50</span>, <span class="dt">max=</span><span class="dv">150</span>),</a>
<a class="sourceLine" id="cb8-10" title="10">                                             <span class="st">'initial-number-wolves'</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">min=</span><span class="dv">50</span>, <span class="dt">max=</span><span class="dv">150</span>)),</a>
<a class="sourceLine" id="cb8-11" title="11">                            <span class="dt">constants =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"model-version"</span> =<span class="st"> "</span><span class="ch">\"</span><span class="st">sheep-wolves-grass</span><span class="ch">\"</span><span class="st">"</span>,</a>
<a class="sourceLine" id="cb8-12" title="12">                                             <span class="st">"grass-regrowth-time"</span> =<span class="st"> </span><span class="dv">30</span>,</a>
<a class="sourceLine" id="cb8-13" title="13">                                             <span class="st">"sheep-gain-from-food"</span> =<span class="st"> </span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb8-14" title="14">                                             <span class="st">"wolf-gain-from-food"</span> =<span class="st"> </span><span class="dv">20</span>,</a>
<a class="sourceLine" id="cb8-15" title="15">                                             <span class="st">"sheep-reproduce"</span> =<span class="st"> </span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb8-16" title="16">                                             <span class="st">"wolf-reproduce"</span> =<span class="st"> </span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb8-17" title="17">                                             <span class="st">"show-energy?"</span> =<span class="st"> "false"</span>))</a></code></pre></div>
</div>
<div id="step-3-attach-a-simulation-design-1" class="section level4">
<h4 class="hasAnchor">
<a href="#step-3-attach-a-simulation-design-1" class="anchor"></a>Step 3: Attach a simulation design</h4>
<p>We use the <code>simdesgin_GenSA()</code> function to attach a Simulated Annealing simdesign. Because we want to post-process our simulation results, we need to define an evaluation function. The evaluation function needs to accept the nl object as input and must return a single numeric value. First we load the package landscapemetrics. We then convert the spatial data to a raster format and calculate the landscape edge density index. Finally, we report only the index value of the resulting tibble.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">critfun &lt;-<span class="st"> </span><span class="cf">function</span>(nl) {</a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(landscapemetrics)</a>
<a class="sourceLine" id="cb9-3" title="3">  res_spat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nl_to_raster.html">nl_to_raster</a></span>(nl)</a>
<a class="sourceLine" id="cb9-4" title="4">  res_spat_raster &lt;-<span class="st"> </span>res_spat<span class="op">$</span>spatial.raster[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb9-5" title="5">  lsm &lt;-<span class="st"> </span><span class="kw">lsm_l_ed</span>(res_spat_raster)</a>
<a class="sourceLine" id="cb9-6" title="6">  crit &lt;-<span class="st"> </span>lsm<span class="op">$</span>value</a>
<a class="sourceLine" id="cb9-7" title="7">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(crit)</a>
<a class="sourceLine" id="cb9-8" title="8">}</a></code></pre></div>
<p>In the <code><a href="../reference/simdesign_GenSA.html">simdesign_GenSA()</a></code> function we now provide our evaluation function (<code>critfun</code>) as evaluation criterion (<code>evalcrit</code>). The control parameter allows us to provide additional parameters for the GenSA function (see ?GenSA for details). For demonstration purposes, we set the maximum number of iterations to 20.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">nl<span class="op">@</span>simdesign &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simdesign_GenSA.html">simdesign_GenSA</a></span>(nl, </a>
<a class="sourceLine" id="cb10-2" title="2">                                <span class="dt">evalcrit =</span> critfun, </a>
<a class="sourceLine" id="cb10-3" title="3">                                <span class="dt">nseeds =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb10-4" title="4">                                <span class="dt">control=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">maxit =</span> <span class="dv">20</span>))</a></code></pre></div>
</div>
<div id="step-4-run-simulations-1" class="section level4">
<h4 class="hasAnchor">
<a href="#step-4-run-simulations-1" class="anchor"></a>Step 4: Run simulations</h4>
<p>For optimization simdesign, the <code><a href="../reference/run_nl_dyn.html">run_nl_dyn()</a></code> function lets you execute the simulations. There are some notable differences between <code><a href="../reference/run_nl_all.html">run_nl_all()</a></code> and <code><a href="../reference/run_nl_dyn.html">run_nl_dyn()</a></code>. First, because parameterizations depend of results from previous runs, <code><a href="../reference/run_nl_dyn.html">run_nl_dyn()</a></code> can not be parallelized. Second, the procedure does not automatically loop over created random seeds of the simdesign. If you want to repeat the same algorithm several times, just embed the <code><a href="../reference/run_nl_dyn.html">run_nl_dyn()</a></code> function in any kind of loop and iterate through the <code>nl@simdesign@simseeds</code> vector. Third, the output of <code><a href="../reference/run_nl_dyn.html">run_nl_dyn()</a></code> is reported as objects from the specific optimization procedures and not in tibble format. In order to attach these results to the nl object, the output needs to be converted to tibble format first. However, attaching optimization results to the nl does not enable any further post-processing functions of the nlrx package and is only relevant for storing results together with the nl object. This design decision was made in order to allow application of the method specific summary functions to the results of the optimization.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/run_nl_dyn.html">run_nl_dyn</a></span>(nl, <span class="dt">seed =</span> nl<span class="op">@</span>simdesign<span class="op">@</span>simseeds[<span class="dv">1</span>])</a></code></pre></div>
</div>
<div id="step-5-investigate-output-1" class="section level4">
<h4 class="hasAnchor">
<a href="#step-5-investigate-output-1" class="anchor"></a>Step 5: Investigate output</h4>
<p>The output list of the Simulated Annealing procedure contains four elements: <code>value</code> reports the minimum final value of the evaluation criterion. <code>par</code> reports the parameter settings of the final parameterisation in the same order as defined in the experiment of the nl object. <code>trace.mat</code> gives you detailed information on the optimization process over all iterations. <code>counts</code> indicates how often the optimization procedure was executed in total.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">results</a></code></pre></div>
<p>In order to store our results together with the nl object we need to attach the results to the nl object first. As explained above, we need to enframe the results as a tibble.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">nl<span class="op">@</span>simdesign<span class="op">@</span>simoutput &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/enframe.html">enframe</a></span>(results)</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(nl, <span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(nl<span class="op">@</span>experiment<span class="op">@</span>outpath, <span class="st">"genSA_2.rds"</span>))</a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#optimization-with-nlrx">Optimization with nlrx</a></li>
      <li><a href="#example-1-netlogo-reporter-as-fitness-criterion">Example 1: NetLogo reporter as fitness criterion</a></li>
      <li><a href="#example-2-evaluation-function-as-fitness-criterion">Example 2: Evaluation function as fitness criterion</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jan Salecker, Marco Sciaini.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
