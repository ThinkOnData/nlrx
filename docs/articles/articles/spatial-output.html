<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial Output • nlrx | NetLogo from R</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Spatial Output">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">nlrx | NetLogo from R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../articles/getstarted.html">
    <span class="fa fa fa fa-magic"></span>
     
    Get Started
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-graduation-cap"></span>
     
    More
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/simdesign-examples.html">
        <span class="fa fa-book"></span>
         
        Simdesign examples
      </a>
    </li>
    <li>
      <a href="../../articles/furthernotes.html">
        <span class="fa fa-sticky-note"></span>
         
        Advanced configuration
      </a>
    </li>
    <li>
      <a href="../../articles/articles/spatial-output.html">
        <span class="fa fa-calculator"></span>
         
        Capturing spatial NetLogo output
      </a>
    </li>
    <li>
      <a href="../../articles/articles/interfacing-different-models.html">
        <span class="fa fa-file-text-o"></span>
         
        Interfacing a variety of different NetLogo models
      </a>
    </li>
    <li>
      <a href="../../articles/articles/nlrx_nldoc.html">
        <span class="fa fa-file-text-o"></span>
         
        NetLogo documentation with nlrx
      </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    news
  </a>
</li>
<li>
  <a href="../../reference/index.html">
    <span class="fa fa-gears"></span>
     
    functions
  </a>
</li>
<li>
  <a href="https://github.com/nldoc/nlrx">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Spatial Output</h1>
                        <h4 class="author">Jan Salecker</h4>
            
            <h4 class="date">2019-03-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nldoc/nlrx/blob/master/vignettes/articles/spatial-output.Rmd"><code>vignettes/articles/spatial-output.Rmd</code></a></small>
      <div class="hidden name"><code>spatial-output.Rmd</code></div>

    </div>

    
    
<div id="gathering-spatial-output-from-netlogo-model-simulations" class="section level2">
<h2 class="hasAnchor">
<a href="#gathering-spatial-output-from-netlogo-model-simulations" class="anchor"></a>Gathering spatial output from NetLogo model simulations</h2>
<p>nlrx is able to gather spatial output from your NetLogo simulations. The experiment class object provides slots for measuring turtles, patches and link variables:</p>
<ul>
<li>metrics.turtles - a list with named vectors of strings defining valid turtles-own variables that are taken as output measurements (e.g. <code>list("turtles" = c("who", "pxcor", "pycor", "color")</code>)</li>
<li>metrics.patches - vector of valid patches-own variables that are used to collect patches data (e.g. <code><a href="https://www.rdocumentation.org/packages/base/topics/c">c("pxcor", "pycor", "pcolor")</a></code>)</li>
<li>metrics.links - a list with named vectors of strings defining valid links-own variables that are taken as output measurements (e.g. <code><a href="https://www.rdocumentation.org/packages/base/topics/list">list("links" = c("[who] of end1", "[who] of end2"))</a></code>)</li>
</ul>
<p>Basically, you can enter any variable of your model that is listed in turtles-own, patches-own or links-own, however if you add variables that contain strings, these strings must not contain any whitespaces or the output data will not be parsed correctly.</p>
<p>If your model has agent variables that only exist for one specific breed (breed-own), measuring those variables for all turtles would result in a runtime error. Thus, different vectors of metrics can be provided for each specific breed (e.g. <code>metrics.turtles = list("breed_A" = c("who", "pxcor", "pycor", "var_of_breed_A"), "breed_B" = c("who", "pxcor", "pycor", "var_of_breed_B"))</code>). This also works for links breeds.</p>
<p>If an experiment contains any agent metrics, the results of these metrics will be nested inside the output results tibble. In order to utilize these data, they need to be postprocessed. nlrx provides two types of postprocessing functions:</p>
<ul>
<li>
<code><a href="../../reference/unnest_simoutput.html">unnest_simoutput()</a></code> - This function may be used to unnest the data within the output results tibble. It reports a long tibble containing all parameters, variables and agent metrics. This format is easily subsettable and is suited to produce plots using the ggplot package, or create animations with gganimate.</li>
<li>
<code><a href="../../reference/nl_to_graph.html">nl_to_graph()</a></code>, <code><a href="../../reference/nl_to_raster.html">nl_to_raster()</a></code>, <code><a href="../../reference/nl_to_points.html">nl_to_points()</a></code> - These functions create spatial objects from the nested data within the output results tibble. Please note, that these functions have requirements on measured spatial variables:
<ul>
<li>
<code><a href="../../reference/nl_to_graph.html">nl_to_graph()</a></code> - Reports igraph objects and needs at least turtle who numbers and who numbers of link ends (<code>metrics.turtles = list("turtles" = c("who")), metrics.links = list("links" = c("[who] of end1", "[who] of end2"))</code>). Additional turtle and link variables will be stored as properties of the igraph nodes and vertices.</li>
<li>
<code><a href="../../reference/nl_to_raster.html">nl_to_raster()</a></code> - Reports raster objects and needs patch coordinates and at least one patch variable (<code>metrics.patches = c("pxcor", "pycor", "pcolor")</code>). If several patch variables are provided, a raster stack is created with rasters for each patch variable.</li>
<li>
<code><a href="../../reference/nl_to_points.html">nl_to_points()</a></code> - Reports spatial point objects and needs at least turtle coordinates, either pxcor/pycor or xcor/ycor (<code>metrics.turtles = list("turtles" = c("xcor", "ycor", "who", "color"))</code>). Additional turtle variables will be stored as properties of the spatial points.</li>
</ul>
</li>
</ul>
</div>
<div id="application-example-1-wolf-sheep-predation" class="section level2">
<h2 class="hasAnchor">
<a href="#application-example-1-wolf-sheep-predation" class="anchor"></a>Application Example 1: Wolf Sheep Predation</h2>
<p>We use the Wolf Sheep Model from the NetLogo models library to capture metrics of patches and turtles. We measure coordinates, who numbers and the breed of turtles, and coordinates of patches and the corresponding pcolor on each tick. We define our experiment accordingly and run the simulations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(nlrx)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(gganimate) <span class="co"># devtools::install_github('thomasp85/gganimate') - if you have troubles installing gganimate, you most likely also need to install gifski as system dependency</span>

<span class="co"># Windows default NetLogo installation path (adjust to your needs!):</span>
netlogopath &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(<span class="st">"C:/Program Files/NetLogo 6.0.3"</span>)
modelpath &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(netlogopath, <span class="st">"app/models/Sample Models/Biology/Wolf Sheep Predation.nlogo"</span>)
outpath &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(<span class="st">"C:/out"</span>)
<span class="co"># Unix default NetLogo installation path (adjust to your needs!):</span>
netlogopath &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(<span class="st">"/home/NetLogo 6.0.3"</span>)
modelpath &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(netlogopath, <span class="st">"app/models/Sample Models/Biology/Wolf Sheep Predation.nlogo"</span>)
outpath &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(<span class="st">"/home/out"</span>)

<span class="co"># Define nl object</span>
nl &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/nl.html">nl</a></span>(<span class="dt">nlversion =</span> <span class="st">"6.0.3"</span>,
         <span class="dt">nlpath =</span> netlogopath,
         <span class="dt">modelpath =</span> modelpath,
         <span class="dt">jvmmem =</span> <span class="dv">1024</span>)

<span class="co"># Define experiment</span>
nl<span class="op">@</span>experiment &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/experiment.html">experiment</a></span>(<span class="dt">expname =</span> <span class="st">"nlrx_spatial"</span>,
                            <span class="dt">outpath =</span> outpath,
                            <span class="dt">repetition =</span> <span class="dv">1</span>,      
                            <span class="dt">tickmetrics =</span> <span class="st">"true"</span>,
                            <span class="dt">idsetup =</span> <span class="st">"setup"</span>,   
                            <span class="dt">idgo =</span> <span class="st">"go"</span>,         
                            <span class="dt">runtime =</span> <span class="dv">100</span>,
                            <span class="dt">metrics =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"count sheep"</span>,<span class="st">"count wolves"</span>),
                            <span class="dt">metrics.turtles =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"turtles"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"who"</span>, <span class="st">"pxcor"</span>, <span class="st">"pycor"</span>)),
                            <span class="dt">metrics.patches =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"pxcor"</span>, <span class="st">"pycor"</span>, <span class="st">"pcolor"</span>),
                            <span class="dt">constants =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"model-version"</span> =<span class="st"> "</span><span class="ch">\"</span><span class="st">sheep-wolves-grass</span><span class="ch">\"</span><span class="st">"</span>,
                                             <span class="st">'initial-number-sheep'</span> =<span class="st"> </span><span class="dv">100</span>,
                                             <span class="st">'initial-number-wolves'</span> =<span class="st"> </span><span class="dv">50</span>,
                                             <span class="st">"grass-regrowth-time"</span> =<span class="st"> </span><span class="dv">30</span>,
                                             <span class="st">"sheep-gain-from-food"</span> =<span class="st"> </span><span class="dv">4</span>,
                                             <span class="st">"wolf-gain-from-food"</span> =<span class="st"> </span><span class="dv">20</span>,
                                             <span class="st">"sheep-reproduce"</span> =<span class="st"> </span><span class="dv">4</span>,
                                             <span class="st">"wolf-reproduce"</span> =<span class="st"> </span><span class="dv">5</span>,
                                             <span class="st">"show-energy?"</span> =<span class="st"> "false"</span>)
                            )

<span class="co"># Attach simdesign simple using only constants</span>
nl<span class="op">@</span>simdesign &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/simdesign_simple.html">simdesign_simple</a></span>(<span class="dt">nl=</span>nl,
                                 <span class="dt">nseeds=</span><span class="dv">1</span>)

<span class="co"># Run simulations and store output in results</span>
results &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/run_nl_all.html">run_nl_all</a></span>(<span class="dt">nl =</span> nl)</code></pre></div>
<p>This experiment will run for 100 ticks (runtime) and collects all metrics, metrics.turtles and metrics.patches on each tick (evalticks). Thus, executing <code><a href="../../reference/run_nl_all.html">run_nl_all()</a></code> will report a tibble containing all metrics, metrics.turtles and metrics.patches. However, because the spatial metrics contain more than one value, these datasets are stored as lists inside the output tibble. These lists already contain all measured agent metrics and can for example be used to analyze distributions of these variables for specific agent groups.</p>
<div id="postprocessing-example-1-unnest_simoutput" class="section level4">
<h4 class="hasAnchor">
<a href="#postprocessing-example-1-unnest_simoutput" class="anchor"></a>Postprocessing example 1: <code><a href="../../reference/unnest_simoutput.html">unnest_simoutput()</a></code>
</h4>
<p>We use the <code><a href="../../reference/unnest_simoutput.html">unnest_simoutput()</a></code> function to create a large tibble format which we can use for plotting. In order to use this function, the simulation output need to be attached to the nl object first (otherwise a warning will appear). The simdesign class within the nl object provides a slot for attaching output results (simoutput). An output results tibble can be attached to this slot by using the simdesign setter function <code><a href="../../reference/setsim.html">setsim(nl, "simoutput")</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Attach results to nl object:</span>
<span class="kw"><a href="../../reference/setsim.html">setsim</a></span>(nl, <span class="st">"simoutput"</span>) &lt;-<span class="st"> </span>results

<span class="co"># Report spatial data:</span>
results_unnest &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/unnest_simoutput.html">unnest_simoutput</a></span>(nl)</code></pre></div>
<p>The spatial tibble output from <code><a href="../../reference/unnest_simoutput.html">unnest_simoutput()</a></code> can for example be used to plot maps for different ticks of the model simulation. Here is an example to create a facet plot using spatial simulation data of every 10th simulation tick:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Split tibble into turtles and patches tibbles and select each 10th step:</span>
results_unnest_turtles &lt;-<span class="st"> </span>results_unnest <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(agent<span class="op">==</span><span class="st">"turtles"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="st">`</span><span class="dt">[step]</span><span class="st">`</span> <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">10</span>,<span class="dv">80</span>,<span class="dv">10</span>))
results_unnest_patches &lt;-<span class="st"> </span>results_unnest <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(agent<span class="op">==</span><span class="st">"patches"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="st">`</span><span class="dt">[step]</span><span class="st">`</span> <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">10</span>,<span class="dv">80</span>,<span class="dv">10</span>))

<span class="co"># Create facet plot:</span>
<span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st">`</span><span class="dt">[step]</span><span class="st">`</span>, <span class="dt">ncol=</span><span class="dv">4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">data=</span>results_unnest_patches, <span class="kw">aes</span>(<span class="dt">x=</span>pxcor, <span class="dt">y=</span>pycor, <span class="dt">fill=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(pcolor))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>results_unnest_turtles, <span class="kw">aes</span>(<span class="dt">x =</span> pxcor, <span class="dt">y =</span> pycor, <span class="dt">color =</span> breed), <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">breaks=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"35"</span>, <span class="st">"55"</span>), <span class="dt">values =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"35"</span> =<span class="st"> "#D9AF6B"</span>, <span class="st">"55"</span> =<span class="st"> "#68855C"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">breaks=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"sheep"</span>, <span class="st">"wolves"</span>), <span class="dt">values =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"sheep"</span> =<span class="st"> "beige"</span>, <span class="st">"wolves"</span> =<span class="st"> "black"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill=</span><span class="kw">guide_legend</span>(<span class="dt">title=</span><span class="st">"LandCover"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Output maps of each 10th simulation tick"</span>)</code></pre></div>
<p><img src="wolfsheep_world.png" align="center" width="100%"></p>
<p>Using the gganimate package(<a href="https://github.com/thomasp85/gganimate" class="uri">https://github.com/thomasp85/gganimate</a>), it is even possible to generate animated plots from this spatial data tibble. Here is an example for a plot that has been generated by running the above experiment and postprocessing the data with <code><a href="../../reference/unnest_simoutput.html">unnest_simoutput()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Split tibble into turtles and patches tibbles:</span>
results_unnest_turtles &lt;-<span class="st"> </span>results_unnest <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(agent <span class="op">==</span><span class="st"> "turtles"</span>)
results_unnest_patches &lt;-<span class="st"> </span>results_unnest <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(agent <span class="op">==</span><span class="st"> "patches"</span>)

<span class="co"># Create an animated plot, using the step column as animation variable</span>
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">data=</span>results_unnest_patches, <span class="kw">aes</span>(<span class="dt">x=</span>pxcor, <span class="dt">y=</span>pycor, <span class="dt">fill=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(pcolor))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>results_unnest_turtles, <span class="kw">aes</span>(<span class="dt">x =</span> pxcor, <span class="dt">y =</span> pycor, <span class="dt">group=</span>who, <span class="dt">color =</span> breed), <span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">breaks=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"35"</span>, <span class="st">"55"</span>), <span class="dt">values =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"35"</span> =<span class="st"> "#D9AF6B"</span>, <span class="st">"55"</span> =<span class="st"> "#68855C"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">breaks=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"sheep"</span>, <span class="st">"wolves"</span>), <span class="dt">values =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"sheep"</span> =<span class="st"> "beige"</span>, <span class="st">"wolves"</span> =<span class="st"> "black"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill=</span><span class="kw">guide_legend</span>(<span class="dt">title=</span><span class="st">"LandCover"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">transition_time</span>(<span class="st">`</span><span class="dt">[step]</span><span class="st">`</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">'Step: {frame_time}'</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_void</span>()

<span class="co"># Animate the plot and use 1 frame for each step of the model simulations</span>
gganimate<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/gganimate/topics/animate">animate</a></span>(p1, <span class="dt">nframes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(results_unnest_patches<span class="op">$</span><span class="st">`</span><span class="dt">[step]</span><span class="st">`</span>)), <span class="dt">width=</span><span class="dv">400</span>, <span class="dt">height=</span><span class="dv">400</span>, <span class="dt">fps=</span><span class="dv">4</span>)
<span class="kw">anim_save</span>(<span class="st">"wolfsheep_world.gif"</span>)</code></pre></div>
<center>
<img src="wolfsheep_world.gif" align="center" width="50%">
</center>
</div>
<div id="postprocessing-example-2-nl_to_raster-and-nl_to_points" class="section level4">
<h4 class="hasAnchor">
<a href="#postprocessing-example-2-nl_to_raster-and-nl_to_points" class="anchor"></a>Postprocessing example 2: <code><a href="../../reference/nl_to_raster.html">nl_to_raster()</a></code> and <code><a href="../../reference/nl_to_points.html">nl_to_points()</a></code>
</h4>
<p>A second option to postprocess spatial data is to convert patches data to raster objects and turtles data to spatial point objects. This can be handy if further spatial analyses are carried out, such as calculating landscape metrics (e.g. with R-package <a href="https://github.com/r-spatialecology/landscapemetrics">landscapemetrics</a>). In this example, we use the nl object with attached simulation output of the previous example to generate raster and spatial point objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Create raster and point objects from patches and turtles data:
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(raster)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sf)
nlraster &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/nl_to_raster.html">nl_to_raster</a></span>(nl)
nlpoints &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/nl_to_points.html">nl_to_points</a></span>(nl, <span class="dt">coords =</span> <span class="st">"px"</span>)

## Plot raster and turtles of tick n:
n &lt;-<span class="st"> </span><span class="dv">1</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(nlraster<span class="op">$</span>spatial.raster[[n]], <span class="dt">col=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"35"</span> =<span class="st"> "#D9AF6B"</span>, <span class="st">"55"</span> =<span class="st"> "#68855C"</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(nlpoints<span class="op">$</span>spatial.turtles[[n]][<span class="st">"breed"</span>], <span class="dt">add=</span><span class="ot">TRUE</span>, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">col=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"sheep"</span> =<span class="st"> "beige"</span>, <span class="st">"wolves"</span> =<span class="st"> "black"</span>))</code></pre></div>
</div>
</div>
<div id="application-example-2-giant-component" class="section level2">
<h2 class="hasAnchor">
<a href="#application-example-2-giant-component" class="anchor"></a>Application example 2: Giant component</h2>
<p>We use the Giant Component model from the NetLogo models library to capture metrics of turtles and links. The <code><a href="../../reference/nl_to_graph.html">nl_to_graph()</a></code> function generates igraph objects from measured turtles and links data. It produces an igraph object for each row of the simoutput results tibble. Thus, it reports one igraph network for each combination of random-seed, siminputrow and step.</p>
<p>In order to generate igraph objects some metrics are mandatory: The metrics.turtles slot of the experiment must contain “who” numbers (see example experiment). Additional turtle metrics will be stored as properties of the igraph vertices. The metrics.links slot of the experiment must contain “who” numbers of link end1 and end2 (see example experiment). Additional link metrics will be stored as properties of the igraph edges.</p>
<p>For our application example, we are mainly interested in the final network structure. We want to measure who numbers and color of turtles, and who numbers of end1 and end2 of links on the final tick. We define our experiment accordingly and run the simulations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(nlrx)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(igraph)

<span class="co"># Windows default NetLogo installation path (adjust to your needs!):</span>
netlogopath &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(<span class="st">"C:/Program Files/NetLogo 6.0.4"</span>)
modelpath &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(netlogopath, <span class="st">"app/models/Sample Models/Networks/Giant Component.nlogo"</span>)
outpath &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(<span class="st">"C:/out"</span>)
<span class="co"># Unix default NetLogo installation path (adjust to your needs!):</span>
netlogopath &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(<span class="st">"/home/NetLogo 6.0.4"</span>)
modelpath &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(netlogopath, <span class="st">"app/models/Sample Models/Networks/Giant Component.nlogo"</span>)
outpath &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(<span class="st">"/home/out"</span>)

nl &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/nl.html">nl</a></span>(<span class="dt">nlversion =</span> <span class="st">"6.0.4"</span>,
         <span class="dt">nlpath =</span> netlogopath,
         <span class="dt">modelpath =</span> modelpath,
         <span class="dt">jvmmem =</span> <span class="dv">1024</span>)

nl<span class="op">@</span>experiment &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/experiment.html">experiment</a></span>(<span class="dt">expname=</span><span class="st">"networks"</span>,
                            <span class="dt">outpath=</span>outpath,
                            <span class="dt">repetition=</span><span class="dv">1</span>,
                            <span class="dt">tickmetrics=</span><span class="st">"false"</span>,
                            <span class="dt">idsetup=</span><span class="st">"setup"</span>,
                            <span class="dt">idgo=</span><span class="st">"go"</span>,
                            <span class="dt">runtime=</span><span class="dv">50</span>,
                            <span class="dt">metrics.turtles =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"turtles"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"who"</span>, <span class="st">"color"</span>)),
                            <span class="dt">metrics.links =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"links"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"[who] of end1"</span>, <span class="st">"[who] of end2"</span>)),
                            <span class="dt">constants =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"num-nodes"</span> =<span class="st"> </span><span class="dv">80</span>,
                                             <span class="st">"layout?"</span> =<span class="st"> "true"</span>))

nl<span class="op">@</span>simdesign &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/simdesign_simple.html">simdesign_simple</a></span>(nl, <span class="dv">1</span>)
results &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/run_nl_all.html">run_nl_all</a></span>(nl)</code></pre></div>
<p>In order to execute the <code><a href="../../reference/nl_to_graph.html">nl_to_graph()</a></code> function, the output results need to be attached to the nl object. Afterwards we can create the igraph object with <code><a href="../../reference/nl_to_graph.html">nl_to_graph()</a></code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Attach results to nl object:</span>
<span class="kw"><a href="../../reference/setsim.html">setsim</a></span>(nl, <span class="st">"simoutput"</span>) &lt;-<span class="st"> </span>results
<span class="co"># Create igraph:</span>
nl.graph &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/nl_to_graph.html">nl_to_graph</a></span>(nl)</code></pre></div>
<p>The igraph objects are attached to the output results tibble in the newly generated column “spatial.links”. In our case, we only have one row of results and thus only one igraph object. We can now extract this object and do some plotting, using the igraph plotting function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Extract graph of tick 1:
nl.graph.i &lt;-<span class="st"> </span>nl.graph<span class="op">$</span>spatial.links[[<span class="dv">1</span>]]
## Set vertex colors by measured color variable:
vcols &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"7"</span> =<span class="st"> "grey"</span>, <span class="st">"15"</span> =<span class="st"> "red"</span>)
<span class="kw">V</span>(nl.graph.i)<span class="op">$</span>color &lt;-<span class="st"> </span>vcols[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(<span class="kw">V</span>(nl.graph.i)<span class="op">$</span>color)]
## Set edge colors by measured link breed:
ecols &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"links"</span> =<span class="st"> "black"</span>)
<span class="kw">E</span>(nl.graph.i)<span class="op">$</span>color &lt;-<span class="st"> </span>ecols[<span class="kw">E</span>(nl.graph.i)<span class="op">$</span>breed]

## Plot:
<span class="kw">plot.igraph</span>(nl.graph.i, <span class="dt">vertex.size=</span><span class="dv">8</span>, <span class="dt">vertex.label=</span><span class="ot">NA</span>, <span class="dt">edge.arrow.size=</span><span class="fl">0.2</span>)</code></pre></div>
<p>We can also calculate network metrics using the igraph package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Extract graph of tick 1:
nl.graph.i &lt;-<span class="st"> </span>nl.graph<span class="op">$</span>spatial.links[[<span class="dv">1</span>]]

## Vertex and edge betweenness centrality
<span class="kw">betweenness</span>(nl.graph.i)

## Clusters
<span class="kw">clusters</span>(nl.graph.i)</code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#gathering-spatial-output-from-netlogo-model-simulations">Gathering spatial output from NetLogo model simulations</a></li>
      <li><a href="#application-example-1-wolf-sheep-predation">Application Example 1: Wolf Sheep Predation</a></li>
      <li><a href="#application-example-2-giant-component">Application example 2: Giant component</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jan Salecker, Marco Sciaini.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
